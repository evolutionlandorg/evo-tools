#!/usr/bin/env bash

set -e

. $(PWD)/bin/init

export REGISTRY_FILE=${DEPLOY_CONFIG?}/bin/conf/${DEPLOY_CHAIN?}-registry.json
export OWNER_FILE=${DEPLOY_CONFIG?}/bin/conf/${DEPLOY_CHAIN?}-owner.json

if [ ! -f "$REGISTRY_FILE" ]; then
cat > "$REGISTRY_FILE" << EOF
{}
EOF
fi

if [ ! -f "$OWNER_FILE" ]; then
cat > "$OWNER_FILE" << EOF
{}
EOF
fi


addressOf() {
    local id=$(seth --to-bytes32 $(seth --from-ascii "${1?}"))
    address=$(seth call @SETTINGSREGISTRY "addressOf(bytes32)(address)" "$id")
    echo "$address"
    addAddress "$REGISTRY_FILE" "$1" "$address"
}

ownerOf() {
    local id=$(seth --to-bytes32 $(seth --from-ascii "${2?}"))
    owner=$(seth call ${1?} "owner()(address)")
    addAddress "$OWNER_FILE" "$2" "$owner"
}

uintOf() {
    local id=$(seth --to-bytes32 $(seth --from-ascii "${1?}"))
    uint=$(seth call @SETTINGSREGISTRY "uintOf(bytes32)(uint256)" "$id") 
    addAddress "$REGISTRY_FILE" "$1" "$uint"
}

addrs=(
    "CONTRACT_RING_ERC20_TOKEN"
    "CONTRACT_KTON_ERC20_TOKEN"
    "CONTRACT_GOLD_ERC20_TOKEN"
    "CONTRACT_WOOD_ERC20_TOKEN"
    "CONTRACT_WATER_ERC20_TOKEN"
    "CONTRACT_FIRE_ERC20_TOKEN"
    "CONTRACT_SOIL_ERC20_TOKEN"
    "CONTRACT_OBJECT_OWNERSHIP"
    "CONTRACT_TOKEN_LOCATION"
    "CONTRACT_LAND_BASE"
    "CONTRACT_USER_POINTS"
    "CONTRACT_INTERSTELLAR_ENCODER"
    "CONTRACT_DIVIDENDS_POOL"
    "CONTRACT_TOKEN_USE"
    "CONTRACT_REVENUE_POOL"
    "CONTRACT_BRIDGE_POOL"
    "CONTRACT_ERC721_BRIDGE"
    "CONTRACT_PET_BASE"
    "CONTRACT_LAND_RESOURCE"
    "CONTRACT_GENE_SCIENCE"
    "CONTRACT_APOSTLE_BASE"
    "CONTRACT_SIRING_AUCTION"
    "CONTRACT_APOSTLE_AUCTION"
    "CONTRACT_CHANNEL_DIVIDEND"
    "CONTRACT_FROZEN_DIVIDEND"
    "CONTRACT_CLOCK_AUCTION"
    # "CONTRACT_HABERG_POTION_SHOP"
    "CONTRACT_MYSTERIOUS_TREASURE"
    "CONTRACT_CONTRIBUTION_POOL"
    "CONTRACT_DEV_POOL"
    "BANCOR_EXCHANGE"
    "CONTRACT_POINTS_REWARD_POOL"
    "CONTRACT_DRILL_BASE"
    # "CONTRACT_DARWINIA_ITO_BASE"
    "CONTRACT_ITEM_BASE"
    "CONTRACT_FORMULA"
    "CONTRACT_METADATA_TELLER"
    "CONTRACT_ERC721_GEGO"
    # "CONTRACT_LP_ELEMENT_TOKEN"
    "CONTRACT_LP_GOLD_ERC20_TOKEN"
    "CONTRACT_LP_WOOD_ERC20_TOKEN"
    "CONTRACT_LP_WATER_ERC20_TOKEN"
    "CONTRACT_LP_FIRE_ERC20_TOKEN"
    "CONTRACT_LP_SOIL_ERC20_TOKEN"
    )

for id in "${addrs[@]}"; do
    addr=$(addressOf "$id")
    if [  "$id" == "CONTRACT_BRIDGE_POOL" ] || [ "$id" == "CONTRACT_CONTRIBUTION_POOL" ] || [ "$id" == "CONTRACT_DEV_POOL" ]; then
      addAddress "$OWNER_FILE" "$id" "$addr"
      continue
    fi
    if [  "$id" == "CONTRACT_GENE_SCIENCE" ] || [ "$id" == "CONTRACT_ERC721_GEGO" ] || [ "$id" == "CONTRACT_LP_GOLD_ERC20_TOKEN" ] || [ "$id" == "CONTRACT_LP_WOOD_ERC20_TOKEN" ] || [ "$id" == "CONTRACT_LP_WATER_ERC20_TOKEN" ] || [ "$id" == "CONTRACT_LP_FIRE_ERC20_TOKEN" ] || [ "$id" == "CONTRACT_LP_SOIL_ERC20_TOKEN" ]; then
      continue
    fi
    ownerOf "$addr" "$id"
done

ownerOf "@SETTINGSREGISTRY" "CONTRACT_SETTINGSREGISTRY"
ownerOf "@GOVERNANCE_APP" "CONTRACT_GOVERNANCE_APP"
ownerOf "@FURNACE_APP" "CONTRACT_FURNACE_APP"
addAddress "$REGISTRY_FILE" "CONTRACT_FURNACE_APP" "$FURNACE_APP"
addAddress "$REGISTRY_FILE" "CONTRACT_GOVERNANCE_APP" "$GOVERNANCE_APP"
addAddress "$REGISTRY_FILE" "CONTRACT_SNAPSHOT_PROXY" "$SNAPSHOT_PROXY"

uints=(
    "UINT_AUCTION_CUT" 
    "UINT_TOKEN_OFFER_CUT"
    "UINT_REFERER_CUT"
    "UINT_BRIDGE_FEE"
    "UINT_AUTOBIRTH_FEE"
    "UINT_MIX_TALENT"
    "UINT_APOSTLE_BID_WAITING_TIME"
    # "UINT_HABERG_POTION_TAX_RATE"
    "UINT_EXCHANGE_ERROR_SPACE"
    "UINT_BANK_UNIT_INTEREST"
    "UINT_BANK_PENALTY_MULTIPLIER"
    "UINT_AUCTION_BID_WAITING_TIME"
    "FURNACE_ITEM_MINE_FEE"
    "UINT_ITEMBAR_PROTECT_PERIOD"
    )

for id in "${uints[@]}"; do
    uintOf "$id" 
done
